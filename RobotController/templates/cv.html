<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>Computer Vision Monitor</title>
  <!-- Utilites and Communication -->
  <script type="text/javascript" src="{{ url_for('static', filename='js/jquery-3.4.1.min.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/jquery.slimscroll.min.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/socket.io.min.js') }}"></script>

  <!-- Visualization and Display -->
  <script type="text/javascript" src="{{ url_for('static', filename='js/popper.min.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/dashboard.js') }}"></script>

  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap.min.css') }}" />
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/iconfont/material-icons.css') }}" />
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/dashboard.css') }}" />

  <style>
    #cvCamDisplay {
      width: 100%;
      height: auto;
    }
    #camDisplay {
      width: 100%;
      height: auto;
    }

    #screenshotCnvs {
      width: 100%;
      height: auto;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="#">Computer Vision Monitor</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="#">Blueshift Robotics</a>
        </li>
      </ul>
    </div>
  </nav>
  <div class="wrapper active d-flex">
    <div class="sideMenu bg-mattBlackLight">
      <div class="sidebar">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a href="/pilot" class="nav-link px-2">
              <i class="material-icons icon">videocam</i>
              <span class="text">Pilot</span>
            </a>
          </li>
          <ul class="navbar-nav">
            <li class="nav-item">
              <a href="/copilot" class="nav-link px-2">
                <i class="material-icons icon">videogame_asset</i>
                <span class="text">Copilot</span>
              </a>
            </li>
            <ul class="navbar-nav">
              <li class="nav-item">
                <a href="/cv" class="nav-link px-2">
                  <i class="material-icons icon">visibility</i>
                  <span class="text">Computer Vision</span>
                </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link px-2">
                  <i class="material-icons icon">settings</i>
                  <span class="text">Settings</span>
                </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link px-2 sideMenuToggler">
                  <i class="material-icons icon expandView">view_list</i>
                  <span class="text">Resize</span>
                </a>
              </li>
            </ul>
      </div>
    </div>

    <div class="content">
      <main>
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-5">
              <div class="bg-mattBlackLight my-3 p-3 mx-0 rounded">
                <div class="text-center">
                  <img id="camDisplay" src="{{ url_for('static', filename='assets/noCamera.png') }}">
                </div>
                <div class="text-center">
                  <img id="cvCamDisplay" src="{{ url_for('static', filename='assets/noCamera.png') }}">
                </div>
              </div>
            </div>
            <div class="col-md-2">
              <div class="bg-mattBlackLight my-3 p-3 mx-0 rounded">
                <h5>Camera</h5>
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                  <label class="btn btn-secondary active">
                    <input type="radio" name="camera-source" value="mainCam" autocomplete="off" checked> Front
                  </label>
                  <label class="btn btn-secondary">
                    <input type="radio" name="camera-source" value="bkpCam1" autocomplete="off"> Back
                  </label>
                  <label class="btn btn-secondary">
                    <input type="radio" name="camera-source" value="cvCam" autocomplete="off"> CV
                  </label>
                </div>
                <button type="button" class="btn btn-secondary my-1 mb-2" id="screenshotBtn">Screenshot</button>
                <h5>Computer Vision</h5>
                <div class="btn-group btn-group-sm" role="group" aria-label="Button group with nested dropdown">
                  <div class="btn-group btn-group-sm" role="group">
                    <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown"
                      aria-haspopup="true" aria-expanded="false">
                      Transect Line
                    </button>
                    <div class="dropdown-menu" id="transectLineDropdown">
                      <a class="dropdown-item" href="#">Original</a>
                      <a class="dropdown-item" href="#">Mask</a>
                      <a class="dropdown-item" href="#">Smooth</a>
                      <a class="dropdown-item" href="#">Contours</a>
                    </div>
                  </div>
                </div>
                <div class="btn-group btn-group-sm mt-1" role="group" aria-label="Button group with nested dropdown">
                  <div class="btn-group btn-group-sm" role="group">
                    <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown"
                      aria-haspopup="true" aria-expanded="false">
                      Coral Health
                    </button>
                    <div class="dropdown-menu" id="coralHealthDropdown">
                      <a class="dropdown-item" href="#">Difference</a>
                      <a class="dropdown-item" href="#">Smooth</a>
                      <a class="dropdown-item" href="#">Change</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-5">
              <div class="bg-mattBlackLight my-3 p-3 mx-0 rounded">
                <div class="text-center">
                  <canvas id="screenshotCnvs" width="1920" height="1080"></canvas>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-4">
              <div class="bg-mattBlackLight my-3 p-3 mx-0 rounded">
                Lorem ipsum, dolor sit amet consectetur adipisicing elit.
                Ratione libero totam rerum eos nam ab perspiciatis voluptatum
                in. Quidem natus autem quae. Velit accusamus sit, perspiciatis
                sunt earum tempora veniam.
                Lorem ipsum, dolor sit amet consectetur adipisicing elit.
                Ratione libero totam rerum eos nam ab perspiciatis voluptatum
                in. Quidem natus autem quae. Velit accusamus sit, perspiciatis
                sunt earum tempora veniam.
                Lorem ipsum, dolor sit amet consectetur adipisicing elit.
                Ratione libero totam rerum eos nam ab perspiciatis voluptatum
                in. Quidem natus autem quae. Velit accusamus sit, perspiciatis
                sunt earum tempora veniam.
                Lorem ipsum, dolor sit amet consectetur adipisicing elit.
                Ratione libero totam rerum eos nam ab perspiciatis voluptatum
                in. Quidem natus autem quae. Velit accusamus sit, perspiciatis
                sunt earum tempora veniam.
                Lorem ipsum, dolor sit amet consectetur adipisicing elit.
                Ratione libero totam rerum eos nam ab perspiciatis voluptatum
                in. Quidem natus autem quae. Velit accusamus sit, perspiciatis
                sunt earum tempora veniam.
              </div>
            </div>
            <div class="col-md-4">
              <div class="bg-mattBlackLight my-3 p-3 mx-0 rounded">
                Lorem ipsum, dolor sit amet consectetur adipisicing elit.
                Ratione libero totam rerum eos nam ab perspiciatis voluptatum
                in. Quidem natus autem quae. Velit accusamus sit, perspiciatis
                sunt earum tempora veniam.
                Lorem ipsum, dolor sit amet consectetur adipisicing elit.
                Ratione libero totam rerum eos nam ab perspiciatis voluptatum
                in. Quidem natus autem quae. Velit accusamus sit, perspiciatis
                sunt earum tempora veniam.
                Lorem ipsum, dolor sit amet consectetur adipisicing elit.
                Ratione libero totam rerum eos nam ab perspiciatis voluptatum
                in. Quidem natus autem quae. Velit accusamus sit, perspiciatis
                sunt earum tempora veniam.
                Lorem ipsum, dolor sit amet consectetur adipisicing elit.
                Ratione libero totam rerum eos nam ab perspiciatis voluptatum
                in. Quidem natus autem quae. Velit accusamus sit, perspiciatis
                sunt earum tempora veniam.
                Lorem ipsum, dolor sit amet consectetur adipisicing elit.
                Ratione libero totam rerum eos nam ab perspiciatis voluptatum
                in. Quidem natus autem quae. Velit accusamus sit, perspiciatis
                sunt earum tempora veniam.
              </div>
            </div>
            <div class="col-md-4">
              <div class="bg-mattBlackLight my-3 p-3 mx-0 rounded">
                Lorem ipsum, dolor sit amet consectetur adipisicing elit.
                Ratione libero totam rerum eos nam ab perspiciatis voluptatum
                in. Quidem natus autem quae. Velit accusamus sit, perspiciatis
                sunt earum tempora veniam.
                Lorem ipsum, dolor sit amet consectetur adipisicing elit.
                Ratione libero totam rerum eos nam ab perspiciatis voluptatum
                in. Quidem natus autem quae. Velit accusamus sit, perspiciatis
                sunt earum tempora veniam.
                Lorem ipsum, dolor sit amet consectetur adipisicing elit.
                Ratione libero totam rerum eos nam ab perspiciatis voluptatum
                in. Quidem natus autem quae. Velit accusamus sit, perspiciatis
                sunt earum tempora veniam.
                Lorem ipsum, dolor sit amet consectetur adipisicing elit.
                Ratione libero totam rerum eos nam ab perspiciatis voluptatum
                in. Quidem natus autem quae. Velit accusamus sit, perspiciatis
                sunt earum tempora veniam.
                Lorem ipsum, dolor sit amet consectetur adipisicing elit.
                Ratione libero totam rerum eos nam ab perspiciatis voluptatum
                in. Quidem natus autem quae. Velit accusamus sit, perspiciatis
                sunt earum tempora veniam.
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
    <script id="screenshot_Script">
      var selectedCamera = "mainCam";

      var canvasScreenshot = document.getElementById('screenshotCnvs');
      var ctxScreenshot = canvasScreenshot.getContext('2d');

      var img = new Image();
      img.src = "{{ url_for('static', filename='assets/noCamera.png') }}";

      img.onload = function () {
        ctxScreenshot.drawImage(img, 0, 0);
      }

      function takeScreenshot() {
        img.src = "/videoFeed/" + selectedCamera;

        img.onload = function () {
          ctxScreenshot.canvas.width = this.width;
          ctxScreenshot.canvas.height = this.height;
          ctxScreenshot.drawImage(img, 0, 0);
        }
      }
    </script>
    <script id="main_Script">
      $(document).ready(function () {
      var socket = io.connect('http://' + document.domain + ':' + location.port);
        // Hide the cvCamera Display
        $('#cvCamDisplay').hide();

        $("#screenshotBtn").click(function () {
          takeScreenshot();
        });

        // Switch computer vision source based on radio buttons
        $('input[type=radio][name=camera-source]').change(function () {
          if (this.value != 'cvCam') {
            $('#camDisplay').show()
            $('#cvCamDisplay').hide()

            // Reset source incase camera is not yet available
            $("#camDisplay").attr("src","{{ url_for('static', filename='assets/noCamera.png') }}");

            if (this.value == 'mainCam') {
              $("#camDisplay").attr("src","/videoFeed/mainCam");
              selectedCamera = "mainCam";
            }
            else if (this.value == 'bkpCam1') {
              $("#camDisplay").attr("src","/videoFeed/bkpCam1");
              selectedCamera = "bkpCam1";
            }
          } else {
            $('#cvCamDisplay').show()
            $('#camDisplay').hide()
            
            // Reset source incase camera is not yet available
            $("#cvCamDisplay").attr("src","{{ url_for('static', filename='assets/noCamera.png') }}");
            $("#cvCamDisplay").attr("src","/videoFeed/cvCam");
            selectedCamera = "cvCam";
          }
        });

        // Switch transect line debug levl based on drop down
        $("#transectLineDropdown a").on("click", function () {
          var id = $(this).text();
          var packet = {
            "tag": "settingChange",
            "data": id,
            "timestamp": Date.now() / 1000 | 0,
            "metadata": "transectLine",
            "highPriority": false
          }
          socket.emit("sendUpdate", packet);
        });

        // Switch coral health debug levl based on drop down
        $("#coralHealthDropdown a").on("click", function () {
          var id = $(this).text();
          var packet = {
            "tag": "settingChange",
            "data": id,
            "timestamp": Date.now() / 1000 | 0,
            "metadata": "coralHealth",
            "highPriority": false
          }
          socket.emit("sendUpdate", packet);
        });

        // Set inital computer vision display source
        $("#cvCamDisplay").attr("src", "/videoFeed/cvCam");
        $("#camDisplay").attr("src", "/videoFeed/"+selectedCamera);
      });
    </script>
</body>

</html>